---
title: "catlvm : CATegorical Latent Variable Model"
subtitle: "Upward-Downward Algorithm"
author: 
 - name: "Youngsun Kim"
   email: "kim0sun@korea.ac.kr"
   address: "Department of Statistics \\newline Korea University"
fontsize: 11pt
fontfamily: mathpazo
kotex: true
# abstract: \lipsum[1]
# keywords: 
#  - "keyword 1"
#  - "keyword 2"
#  - "keyword 3"
#  - "..."
output: 
   ysktmplt::pdf_manuscript:
      keep_tex: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Hidden Markov tree {#hmt}


# Hierarchical latent class model {#hlca}
$$
\pi_k = \textsf{Pr}\left( C_1 = k \right),
\;\;
\tau_{k|l}^{(u)} = \textsf{Pr}\left( C_u = k|C_{\rho(u)} = l \right),
\; \text{and} \;\;
\rho_{mr|k}^{(u)} = \textsf{Pr}\left( Y_{m(u)} = r | C_{u} = k \right)
$$
Upward recursion
$$
\begin{aligned}
\xi_{i(u)}(k) &= \textsf{Pr}\left( \mathbf{Y}_{i(u)} = \mathbf{y}_{i(u)} | C_u = k \right) = 
\prod_{m = 1}^{M} \rho_{my_m|k}^{(u)}
\\
\lambda_{i(v)}(k) &= \xi_{i(v)}(k)
\\
\lambda_{i(\rho(u), u)}(l) &= \sum_k \tau_{k, l}^{(u)} \lambda_{i(u)}(k)
\\
\lambda_{i(u)}(k) &= \left\{ \prod_{v\in \mathbf{c}(u)} \lambda_{i(u, v)}(k) \right\} \xi_{i(u)}(k)
\end{aligned}
$$

Downward recursion
$$
\begin{aligned}
\alpha_{i(u)}(k) = \sum_{l}\frac{\tau_{k|l}^{(u)} \alpha_{i(\rho(u))}(l)  \lambda_{i(\rho(u))}(l)}{\lambda_{i(\rho(u), u)}(l)}
\end{aligned}
$$

Posterior probabilities
$$
\begin{aligned}
\theta_{i(u)}(k) &= \textsf{Pr}\left( C_u = k | \bar{\mathbf{Y}}_i = \bar{\mathbf{y}}_i \right) 
= \frac{ \textsf{Pr}\left( C_u = k, \bar{\mathbf{Y}}_i = \bar{\mathbf{y}}_i \right) }{ \textsf{Pr}\left( \bar{\mathbf{Y}}_i = \bar{\mathbf{y}}_i \right) }
\\
&=\frac{ \textsf{Pr}\left( C_u = k, \bar{\mathbf{Y}}_{i(1\backslash u)} = \bar{\mathbf{y}}_{i(1\backslash u)} \right) \times \textsf{Pr}\left( \bar{\mathbf{Y}}_{i(u)} = \bar{\mathbf{y}}_{i(u)} | C_u = k \right) }{ \textsf{Pr}\left( \bar{\mathbf{Y}}_i = \bar{\mathbf{y}}_i \right) }
\\
&= \frac{ \alpha_{i(u)}(k) \lambda_{i(u)}(k) }{ \sum_j \alpha_{i(v)}(j) \lambda_{i(v)}(j) }
\\
\\
\theta_{i(\rho(u), u)}(k,l) &= \textsf{Pr}\left( C_u = k, C_{\rho(u)} = l | \bar{\mathbf{Y}}_i = \bar{\mathbf{y}}_i \right) 
\\
&= \frac{\lambda_{i(u)}(k) \tau_{k|l}^{(u)} \alpha_{i(\rho(u))}(j)  \lambda_{i(\rho(u))}(j)}{\lambda_{i(u, \rho(u))}(j) \sum_j \alpha_{i(v)}(j) \lambda_{i(v)}(j)}
\end{aligned}
$$
